{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load widget_tweaks %}
{% load two_factor_tags %}

{% block content %}
    <header>
        <h1>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                <path d="M3 3.25c0-.966.784-1.75 1.75-1.75h5.5a.75.75 0 0 1 0 1.5h-5.5a.25.25 0 0 0-.25.25v17.5c0 .138.112.25.25.25h5.5a.75.75 0 0 1 0 1.5h-5.5A1.75 1.75 0 0 1 3 20.75Zm9.994 9.5 3.3 3.484a.75.75 0 0 1-1.088 1.032l-4.5-4.75a.75.75 0 0 1 0-1.032l4.5-4.75a.75.75 0 0 1 1.088 1.032l-3.3 3.484h8.256a.75.75 0 0 1 0 1.5Z"></path>
            </svg>
            {% block title %}{% trans "Sign in" %}{% endblock %}
        </h1>

        {% if wizard.steps.current == 'auth' %}
            <small style="text-align: justify"{% if user.is_authenticated %} class="banner warning"{% endif %}>
                {% if user.is_authenticated %}
                    {% url "two_factor:profile" as url %}
                    {% blocktranslate trimmed with username=user.username %}
                        You are already signed in as <b>@{{ username }}</b>, if you would
                        like to sign in with a different account, you may use the form below.
                        Alternatively, you may navigate to <a href="{{ url }}">your account</a>.
                    {% endblocktranslate %}
                {% else %}
                    <small>{% blocktrans %}To continue, please enter your credentials.{% endblocktrans %}</small>
                {% endif %}
            </small>
        {% elif wizard.steps.current == 'token' %}
            <small>{% translate "To continue, enter the code generated by your authenticator." %}</small>
        {% elif wizard.steps.current == 'backup' %}
            <small>
                {% blocktrans trimmed %}
                    Use this form for entering backup tokens for logging in.
                    These tokens have been generated for you to print and keep safe. Please
                    enter one of these backup tokens to login to your account.
                {% endblocktrans %}
            </small>
        {% endif %}
    </header>

    {% if wizard.form.non_field_errors %}
        {% for error in wizard.form.non_field_errors %}
            <p class="banner danger">{{ error }}</p>
        {% endfor %}
    {% endif %}

    <section class="subject">
        <form action="" method="post" class="input-cluster gap2">
            {% csrf_token %}
            {{ wizard.management_form }}

            {% if wizard.steps.current == 'auth' %}
                <div class="input-cluster">
                    <div class="input-group">
                        <label for="login_username">{% translate "Email address" %}</label>
                        {% render_field wizard.form.username id="login_username" type="email" %}
                        {% if wizard.form.username.errors %}
                            {% for error in wizard.form.username.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        {% endif %}
                    </div>

                    <div class="input-group">
                        <label for="login_password">{% translate "Password" %}</label>
                        {% render_field wizard.form.password id="login_password" %}
                        {% if wizard.form.password.errors %}
                            {% for error in wizard.form.password.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        {% endif %}
                        <small><a href="#StubLink">Forgot password?</a></small>
                    </div>
                </div>
            {% elif wizard.steps.current == 'token' or wizard.steps.current == 'backup' %}
                <div class="input-group">
                    <label for="login_otp_token">Code</label>
                    {% render_field wizard.form.otp_token id="login_otp_token" %}
                    {% if wizard.form.otp_token.errors %}
                        {% for error in wizard.form.otp_token.errors %}
                            <small class="text-danger">{{ error }}</small>
                        {% endfor %}
                    {% endif %}
                </div>
            {% endif %}
            {# hidden submit button to enable [enter] key #}
            <input type="submit" value="" hidden/>
            {% include "two_factor/_wizard_actions.html" %}
            {% if wizard.steps.current == 'auth' %}
                <a class="btn secondary muted" href="#StubLink">{% translate "Create a new account" %}</a>
            {% endif %}
        </form>

        {% block 'backup_tokens' %}
            {% if backup_tokens %}
                <div class="backup_tokens_form">
                    <form action="" method="post">
                        {% csrf_token %}
                        <button name="wizard_goto_step" type="submit" value="backup"
                                class="btn secondary muted">{% trans "Use Backup Token" %}</button>
                    </form>
                </div>
            {% endif %}
        {% endblock %}
    </section>
{% endblock %}
