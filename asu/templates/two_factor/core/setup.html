{% extends "two_factor/_base_focus.html" %}
{% load i18n %}
{% load widget_tweaks %}

{% block content %}
    <header>
        <h1>
            {% block title %}{% trans "Enable Two-Factor Authentication" %}{% endblock %}
        </h1>
    </header>

    {% if wizard.form.non_field_errors %}
        {% for error in wizard.form.non_field_errors %}
            <p role="alert" class="banner danger">{{ error }}</p>
        {% endfor %}
    {% endif %}

    <div class="subject">
        {% if wizard.steps.current == 'welcome' %}
            <p>
                {% blocktrans trimmed %}
                    You are about to take your account security to the
                    next level. Follow the steps in this wizard to enable two-factor
                    authentication.
                {% endblocktrans %}
            </p>
        {% elif wizard.steps.current == 'generator' %}
            <p>
                {% blocktrans trimmed %}
                    To start using a token generator, please use your
                    smartphone to scan the QR code below. For example, use Google
                    Authenticator.
                {% endblocktrans %}
            </p>

            <img src="{{ QR_URL }}" alt="QR Code" class="qrcode"/>

            <p>
                {% blocktrans trimmed %}
                    Alternatively you can use the following secret to
                    setup your authenticator or password manager manually:
                {% endblocktrans %}
            </p>
            <a class="btn" href="{{ otpauth_url }}">{{ secret_key }}</a>
        {% endif %}

        <form action="" class="input-cluster gap2" method="post">
            {% csrf_token %}
            <div>
                {{ wizard.management_form }}
                {% if wizard.form.token %}
                    <div class="input-group">
                        <label for="gen_token">{% translate "Now, enter the token generated by the app:" %}</label>
                        {% render_field wizard.form.token id="gen_token" %}
                        {% if wizard.form.token.errors %}
                            {% for error in wizard.form.token.errors %}
                                <small class="text-danger">{{ error }}</small>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endif %}
                {# hidden submit button to enable [enter] key #}
                <input type="submit" value="" hidden/>
            </div>
            {% include "two_factor/_wizard_actions.html" %}
        </form>
    </div>
{% endblock %}
